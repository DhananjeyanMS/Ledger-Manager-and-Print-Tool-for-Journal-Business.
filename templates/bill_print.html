<!DOCTYPE html>
<html>
<head>
    <title>Print Ledger Bill</title>
    <style>
    @media print {
        body {
            margin: 0;
            padding: 10mm;
            font-size: 12px;
        }
        .no-print {
            display: none;
        }
        @page {
            size: A4 portrait;
            margin: 0;
        }
        .print-block {
            page-break-inside: avoid;
            break-inside: avoid;
        }
    }
    body {
        font-family: Arial, sans-serif;
        width: 90%;
        margin: 0 auto;
        padding: 10px;
        font-size: 12px;
    }
    .header {
        text-align: center;
        font-weight: bold;
        font-size: 12px;
        margin-bottom: 5px;
    }
    .top-flex {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8px;
    }
    .bill-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
        margin-top: 8px;
    }
    .bill-table th, .bill-table td {
        border: 1px solid black;
        padding: 4px;
        text-align: center;
    }
    .right-align {
        text-align: right;
    }
    .footer {
        margin-top: 10px;
        font-size: 12px;
    }
    </style>
</head>
<body>
<div class="print-block">
<!-- Bill Section Start -->
<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
    <div style="text-align: left; width: 33%;">
        <div style="font-size: 18px; font-weight: bold;">MALLIGAI MAGAL</div>
        <div style="font-size: 11px;">
            New # 4, Old # 46, Taylors Estate 2nd Street,<br>
            Kodambakkam, Chennai - 600 024.<br>
            Phone : 044 - 2472 0565, 75501 83899
        </div>
    </div>
    <div style="width: 34%; text-align: center;">
        <img src="{{ url_for('static', filename='logo.jpg') }}" alt="Logo" style="height: 60px;">
        <div style="font-size: 14px; font-weight: bold;">BILL</div>
        <div>No : <strong>{{ ledger.id }}</strong></div>
    </div>
    <div style="text-align: right; width: 33%;">
        <div style="font-size: 15px;"><strong>To:</strong> {{ agent.agent_Name }}</div>
        <div style="font-size: 15px;"><strong>Location:</strong>{{ agent.area }}</div>
        <div style="margin-top: 10px; font-size: 15px;"><strong>Month:</strong> {{ ledger.entry_date.strftime('%B %y') }}</div>
    </div>
</div>
<div class="header">
    MALLIGAI MAGAL, A/c No.1155115000015986, Karur Vysya Bank, Kodambakkam branch, IFSC Code: KVBL0001155
</div>
<table class="bill-table">
    <thead>
    <tr>
        <th>S.No</th>
        <th>Particulars</th>
        <th>Rate</th>
        <th>Copies</th>
        <th>Discount</th>
        <th>Amount (Rs.)</th>
    </tr>
    </thead>
    <tbody>
    {% set items = [
        ('Malligai Magal', ledger.count_MM, 40),
        ('Nalla Saappadu', ledger.count_NS, 50),
        ('Valli Novel', ledger.count_Valli, 40),
        ('Vaani Novel', ledger.count_Vani, 40),
        ('Azhagi Novel', ledger.count_Azhagi, 40),
        ('Arasi Novel', ledger.count_Arasi, 40),
        ('Thriller Novel', ledger.count_Thriller, 40)
    ] %}
    {% for idx in range(1, items|length + 1) %}
        {% set name, count, rate = items[idx - 1] %}
        {% set amt = (count or 0) * rate %}
        {% set discount = amt * 0.25 %}
        {% set final_amt = amt - discount %}
        <tr>
            <td>{{ idx }}</td>
            <td>{{ name }}</td>
            <td>Rs.{{ rate }}/-</td>
            <td>{{ count or 0 }}</td>
            <td>25%</td>
            <td>{{ "%.2f"|format(final_amt) }}</td>
        </tr>
    {% endfor %}
    </tbody>
    <tfoot>
        <tr>
            <td colspan="5" class="right-align"><strong>Total</strong></td>
            <td>{{ "%.2f"|format(ledger.bill_Amount) }}</td>
        </tr>
        <tr>
            <td colspan="5" class="right-align"><strong>Old Balance</strong></td>
            <td>{{ "%.2f"|format(ledger.old_balance_Amount) }}</td>
        </tr>
        <tr>
            <td colspan="5" class="right-align"><strong>GRAND TOTAL</strong></td>
            <td>{{ "%.2f"|format(ledger.new_balance_Amount) }}</td>
        </tr>
    </tfoot>
</table>
<div class="footer">
  <div style="margin-top: 20px;">
    <div style="float: left;">
        <div>Cir. Manager</div>
        <div><strong>for MALLIGAI MAGAL</strong></div>
    </div>
    <div style="float: right; font-weight: bold;">
        (Rs. {{ '%.2f' | format(ledger.new_balance_Amount) }} ONLY /-)
    </div>
    <div style="clear: both;"></div>
</div>
</div>
<!-- Bill Section End -->
</div>
</body>
</html> 